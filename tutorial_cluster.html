<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Compmake on a cluster &mdash; Compmake make for batch Python processes</title>
    
    <link rel="stylesheet" href="_static/haiku.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '0.9.3',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <link rel="top" title="Compmake make for batch Python processes" href="index.html" />
    <link rel="next" title="The compmake console" href="tutorial_console.html" />
    <link rel="prev" title="Basic compmake usage" href="tutorial_basic.html" />
	 
	
   <style type="text/css">
   .pagetoc { 
	max-width: 30%;
	display: block; float: right; margin-left: 3em; background-color: white; border: solid 2px gray;}
   </style>

   <style type="text/css">
	div.col1 {
		display: block;
		float: left;
	}

	div.col2 {
		margin-left: 3em;
		display: block;
		float: left;
	}

	div.after {
		clear: left;
	}

	div.twitterbadge {
		float: right;
		margin-left: 2em;
	}

	img.bigpicture {
		margin: 1em;
		max-width: 90%;
	}
	
	.header h2 {
		color: #990033 !important;
		font-size: 200% !important;
	}
	.content {
/*		padding-left: 5em; */
	}
	.content p, .content ul, .content ol {
		max-width: 40em;
	}
	
	.content h1 { 
		display: none;
	}
	h2, h3 {  
		border-bottom: solid 2px orange;
		max-width: 40em;
	}
	
	h1 { font-size: 200%;}
	h2 { font-size: 150%;}
	h3 { font-size: 125%;}
	
/*	body { font-size: 120%; font-family: Georgia,Serif !important;} */
		
	pre{
		max-width: 60em;
	/*	width: 80ex;*/
	}
	
	body {  font-size: 120%; 
		font-family: "Verdana", sans-serif;
		/*font-family: "Droid Serif", serif; */
	}
	
	h1,h2,h3 { 
  font-family: "Lobster", serif;
  font-style: normal;
  font-weight: 400;
  text-shadow: 6px 6px 6px #ccc;
}

div.header h2 {
    font-size: 1.3em;
    font-weight: normal;
    letter-spacing: 1px;
    text-transform: none !important;
    color: #aaa;
    border: 0;
    margin-top: -3px;
    padding: 0;
}

/* On the first page */

.col1 strong, .col2 strong { 
	font-family: "Lobster", serif; color: #990033;text-shadow: 6px 6px 6px #ccc;
	font-size: 160%;
 }

/*.compmake-brand {
	font-family: "Lobster", serif;
	font-size: 120%;
}*/

.compmake-brand {
	/*font-family: "Droid Serif";*/
	font-weight: bold;
}


a.reference em, a.external em {
	font-style: normal !important;
}

/* First page layout */

/*
	div#logo
	div#intro

*/
div#logo, div.intro { 
		
	}
    div.intro ul, div.intro p {float: left; }
    h2 { clear: both;}
	div#logo {
		float: left;
		margin: 1em;
        margin-right: 4em;
	}
	div#logo img {
        border: solid 1px red;
		width: 15em;
	}
</style>


<meta name="google-site-verification" content="Wu274srIjeOWKp_9iWmydewgQsd8zyTuNSYFZ36fQd4" />

<!-- <link  href="http://fonts.googleapis.com/css?family=Lobster" rel="stylesheet" type="text/css" > -->
<link  href="http://fonts.googleapis.com/css?family=Droid+Serif" rel="stylesheet" type="text/css" >
<!--<link  href="http://fonts.googleapis.com/css?family=Cardo" rel="stylesheet" type="text/css" >-->

<!-- 
<script src="http://yui.yahooapis.com/3.1.0/build/yui/yui-min.js"></script>
<link rel="stylesheet" type="text/css" href="http://yui.yahooapis.com/3.1.0/build/cssreset/reset-context-min.css"></link>
<script src="http://www.remarkbox.com/deploy/remarkbox-min.js"></script>
<script type="text/javascript">
YUI().use('remarkbox', function (Y) {
Y.Remarkbox.remarkson.elements("p,code");
Y.Remarkbox.remarkson.ids("para,tnt");
Y.Remarkbox.remarkson.classes("rmkit,contentfeedback");
Y.Remarkbox.remarktype.pointer("right");
Y.Remarkbox.remarktype.strongcolor("#ECFCE8");
Y.Remarkbox.remarktype.strongcolortext("#000000");
Y.Remarkbox.remarktype.lightcolor("#FF8040");
Y.Remarkbox.remarktype.lightcolortext("#800000");
Y.Remarkbox.remarktype.alwaysvisible("true");
Y.Remarkbox.remarktype.offsetx("-3em");
Y.Remarkbox.remarktype.offsety("-2em");
Y.Remarkbox.remarktype.allowanonymous("true");
Y.Remarkbox.render();
});
</script>
-->



  </head>
  <body>
      <div class="header"><h1 class="heading"><a href="index.html">
          <span></span></a></h1>
        <h2 class="heading"><span>Compmake on a cluster</span></h2>
      </div>
      <div class="topnav">
      
        <p>
        «&#160;&#160;<a href="tutorial_basic.html">Basic compmake usage</a>
        &#160;&#160;::&#160;&#160;
        <a class="uplink" href="index.html">Contents</a>
        &#160;&#160;::&#160;&#160;
        <a href="tutorial_console.html">The compmake console</a>&#160;&#160;»
        </p>

      </div>
      <div class="content">
        
        
  <div class="section" id="compmake-on-a-cluster">
<span id="tutorial-cluster"></span><h1>Compmake on a cluster<a class="headerlink" href="#compmake-on-a-cluster" title="Permalink to this headline">¶</a></h1>
<p>Also note that you have to configure <span class="compmake-brand">compmake</span> to use
<a class="reference external" href="http://code.google.com/p/redis/">Redis</a> (and install <a class="reference external" href="http://github.com/andymccurdy/redis-py">redis-py</a>).</p>
<div class="section" id="configuration">
<h2>Configuration<a class="headerlink" href="#configuration" title="Permalink to this headline">¶</a></h2>
<p>You have to provide <span class="compmake-brand">compmake</span> with a configuration file describing
the machines in your cluster. We use the <a class="reference external" href="http://www.yaml.org/">YAML</a> format.
Here is an example configuration file:</p>
<div class="highlight-python"><div class="highlight"><pre>hosts:
        nickname_machine1:
                host: 10.0.0.1
                processors: 3

        nickname_machine2:
                host: 10.0.0.2
                processors: 8
</pre></div>
</div>
<p>You can omit the <tt class="docutils literal"><span class="pre">host</span></tt> attribute, <span class="compmake-brand">compmake</span> will guess that the nickname is the hostname:</p>
<div class="highlight-python"><div class="highlight"><pre>hosts:
        10.0.0.1:
                processors: 3

        10.0.0.1:
                processors: 8
</pre></div>
</div>
<p>The <tt class="docutils literal"><span class="pre">processors</span></tt> field tells <span class="compmake-brand">compmake</span> how many jobs to spawn on that machine.</p>
<p>By default, <span class="compmake-brand">compmake</span> looks for a file named <tt class="docutils literal"><span class="pre">cluster.yaml</span></tt> in the current directory. It is possible to specify a different file using the <tt class="docutils literal"><span class="pre">--cluster-conf</span></tt> option.</p>
<p>Therefore, a minimal command line for using <span class="compmake-brand">compmake</span>&#8216;s cluster capabilities is:</p>
<div class="highlight-python"><div class="highlight"><pre>$ compmake --db=redis --cluster_conf my_cluster.yaml  &lt;my module&gt;
</pre></div>
</div>
<p>The configuration switch <tt class="docutils literal"><span class="pre">cluster_nice</span></tt> gives the <a class="reference external" href="http://en.wikipedia.org/wiki/Nice_%28Unix%29">nice</a> level to use when spawning processes.</p>
</div>
<div class="section" id="the-details-of-how-compmake-uses-clustering">
<h2>The details of how compmake uses clustering<a class="headerlink" href="#the-details-of-how-compmake-uses-clustering" title="Permalink to this headline">¶</a></h2>
<p>This is an explanation (for developers) of how
<span class="compmake-brand">compmake</span> spawns processes on a cluster.</p>
<p>Clustering works by spawning <span class="compmake-brand">compmake</span> processes on other hosts.</p>
<p>What happens is that <span class="compmake-brand">compmake</span> is spawned using a command line similar to this:</p>
<div class="highlight-python"><div class="highlight"><pre>ssh nessa.cds.caltech.edu -R 13005:redisdb:6379
    nice -n 10 compmake --hostname=nessa.cds.caltech.edu
                        --db=redis --redis_host=localhost:13005
                        --save_progress=False
                        --slave  &lt;namespace&gt;
                make_single  &lt;job name&gt;
</pre></div>
</div>
<p>This long command line contains several pieces. Let&#8217;s deconstruct it:</p>
<ul>
<li><p class="first"><tt class="docutils literal"><span class="pre">ssh</span> <span class="pre">nessa.cds.caltech.edu</span> <span class="pre">-R</span> <span class="pre">13005:redisdb:6379</span> <span class="pre">...</span></tt></p>
<p>This opens a ssh connection to the given host. Moreover, it opens a tunnel for accessing the redis server.
In this case, port 13005 on the remote host is redirected to the host redisdb (port 6379).
You got to have the power to use these redirects</p>
</li>
<li><p class="first"><tt class="docutils literal"><span class="pre">...</span> <span class="pre">nice</span> <span class="pre">-n</span> <span class="pre">10</span> <span class="pre">...</span></tt></p>
<p>This selects the nice level (option <tt class="docutils literal"><span class="pre">cluster_nice</span></tt>). Be nice to your fellow users.</p>
</li>
<li><p class="first"><tt class="docutils literal"><span class="pre">...</span> <span class="pre">compmake</span> <span class="pre">--hostname=nessa.cds.caltech.edu</span>&nbsp; <span class="pre">...</span></tt></p>
<p>The <tt class="docutils literal"><span class="pre">hostname</span></tt> option gives a nickname to the slave. This nickname is only used
for statistics purposes.</p>
</li>
<li><p class="first"><tt class="docutils literal"><span class="pre">...</span> <span class="pre">--db=redis</span> <span class="pre">--redis_host=localhost:13005</span> <span class="pre">...</span></tt></p>
<p>This selects redis as the DB backend and uses port 13005 to connect to it.</p>
</li>
<li><p class="first"><tt class="docutils literal"><span class="pre">...</span> <span class="pre">--save_progress=False</span> <span class="pre">...</span></tt></p>
<p>The incremental saving progrees is disabled on remote hosts for network performance purposes.</p>
<p>CONFIG: progress</p>
</li>
<li><p class="first"><tt class="docutils literal"><span class="pre">...</span> <span class="pre">--slave</span> <span class="pre">&lt;namespace&gt;</span> <span class="pre">...</span></tt></p>
<p>The <tt class="docutils literal"><span class="pre">--slave</span></tt> option tells compmake to read the jobs from the DB, instead of running
the module. The module name here is used only as a namespace.</p>
<p>SEE: namespaces</p>
</li>
<li><p class="first"><tt class="docutils literal"><span class="pre">...</span> <span class="pre">make_single</span>&nbsp; <span class="pre">&lt;job</span> <span class="pre">name&gt;</span></tt></p>
<p>Finally, the actual compmake command. <tt class="docutils literal"><span class="pre">make_single</span></tt> is like <tt class="docutils literal"><span class="pre">make</span></tt> but without the
scheduler. The slave will not look at the job&#8217;s dependences, and it will throw an error
if the depenencies are not up to date.</p>
</li>
</ul>
</div>
</div>


      </div>
      <div class="bottomnav">
      
        <p>
        «&#160;&#160;<a href="tutorial_basic.html">Basic compmake usage</a>
        &#160;&#160;::&#160;&#160;
        <a class="uplink" href="index.html">Contents</a>
        &#160;&#160;::&#160;&#160;
        <a href="tutorial_console.html">The compmake console</a>&#160;&#160;»
        </p>

      </div>

	
    <div class="footer">
        &copy; Copyright .
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.2.3.
    </div>
	
	<script type="text/javascript">

	  var _gaq = _gaq || [];
	  _gaq.push(['_setAccount', 'UA-155626-4']);
	  _gaq.push(['_trackPageview']);

	  (function() {
	    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
	    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
	    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
	  })();

	</script>


  </body>
</html>